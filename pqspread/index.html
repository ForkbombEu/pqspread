<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quantum-Safe Encryption/Decryption</title>
  </head>
  <body class="p-10">
    <div class="flex flex-col gap-4 max-w-4xl mx-auto">
      <div class="flex items-baseline gap-2">
        <h1
          class="monospace text-3xl anim-text animate-text bg-gradient-to-r from-[#ca9ee6] via-[#e5c890] ] to-[#8caaee] bg-clip-text text-transparent font-black"
        >
          <a href="/"> PQSpread</a>
        </h1>
        <span class="text-xs">
          kindly by
          <a
            href="https://forkbomb.solutions"
            class="font-bold monospace underline text-[#1C39BB] whitespace-nowrap"
          >
            THE FORKBOMB COMPANY
          </a>
        </span>
      </div>

      <p class="text-sm">
        This html page enables quantum-safe file encryption and decryption using
        the
        <a
          href="https://csrc.nist.gov/pubs/fips/203/final"
          class="underline"
          target="_blank"
          >MLB-KEM standard</a
        >, ensuring security against quantum threats. All cryptographic
        operations are powered by our custom implementation built entirely
        in-house using the cutting-edge
        <a
          href="https://zenroom.org/"
          class="underline text-[#8839ef]"
          target="_blank"
          >Zenroom virtual machine</a
        >.
      </p>
      <p class="text-sm">
        As one of the first to implement this advanced technology, we provide a
        secure, client-side solution with no remote data storage required. Use
        it online
        <a
          href="https://forkbombeu.github.io/pqspread"
          class="underline text-[#8839ef]"
        >
          https://forkbomb.eu/pqspread</a
        >

        or for <strong>offline and paranoid mode</strong> download a single html
        file to run on your machine from
        <a
          href="https://github.com/forkbombeu/pqspread"
          class="underline text-[#8839ef]"
        >
          github.com/forkbombeu/pqspread
        </a>
      </p>
      <span class="text-xs text-end">
        made with ‚ù§Ô∏è‚Äçüî• by
        <a
          href="https://forkbomb.solutions"
          class="font-bold monospace underline text-[#1C39BB]"
        >
          FORKBOMB</a
        >
        hackers
      </span>
    </div>

    <div x-data="PQSpread()" class="max-w-4xl mx-auto">
      <!-- Selection of mode -->
      <div class="mb-4">
        <hr class="m-6" />
        <p class="mb-6">
          <strong>Act now!</strong>
          Click Encrypt to secure and share your files, or Decrypt to restore
          files sent to you‚Äîfast, secure, and
          <span class="border-b-3 border-[#1C39BB]"> quantum-safe! </span>
        </p>
        <button
          @click="setMode('encrypt')"
          :class="mode === 'encrypt' ? 'bg-[#1C39BB] text-white' : ''"
          class="border px-4 py-2 focus:outline-none border-[#1C39BB]"
        >
          Encrypt
        </button>
        <button
          @click="setMode('decrypt')"
          :class="mode === 'decrypt' ? 'bg-[#1C39BB] text-white' : ''"
          class="border px-4 py-2 focus:outline-none border-[#1C39BB]"
        >
          Decrypt
        </button>
      </div>
      <div class="grid grid-cols-8 gap-4">
        <!-- Timeline -->
        <div class="timeline col-span-3">
          <template x-if="mode">
            <ol class="list-none">
              <template x-for="(step, index) in steps" :key="index">
                <li
                  :class="{'current': index === currentStep, 'completed': index < currentStep, 'future': index > currentStep}"
                  :data-step="(index + 1) + '.'"
                >
                  <div>
                    <!-- Clickable title link for active steps only -->
                    <a
                      href="#"
                      @click.prevent="index === currentStep && handleStepAction(step, index)"
                      x-text="step.title"
                    >
                    </a>

                    <!-- File upload trigger -->
                    <template x-if="index === currentStep && step.uploadFile">
                      <div class="mt-2">
                        <label for="fileUpload" class="cursor-pointer"
                          >Upload a file</label
                        >
                        <input
                          type="file"
                          id="fileUpload"
                          @change="handleFileUpload($event)"
                          class="hidden"
                        />
                      </div>
                    </template>

                    <!-- Public Key input -->
                    <template
                      x-if="index === currentStep && step.importPublicKey"
                    >
                      <div class="mt-2">
                        <label for="publicKey" class="block mb-1 font-bold"
                          >Enter Sender's Public Key:</label
                        >
                        <textarea
                          id="publicKey"
                          x-model="publicKey"
                          class="w-full border p-2 text-sm"
                        ></textarea>
                        <button
                          class="mt-2 px-4 py-2 bg-[#1C39BB] text-white border rounded hover:bg-gray-800"
                          @click="handleStepAction(step, index)"
                        >
                          Proceed
                        </button>
                      </div>
                    </template>

                    <!-- Display spinner or output for each step independently -->
                    <div class="text-sm mt-2 overflow-hidden">
                      <template x-if="loadingSteps[index]">
                        <div class="spinner"></div>
                      </template>
                      <template x-if="!loadingSteps[index] && step.output">
                        <pre
                          class="font-mono overflow-x-auto max-w-3xl"
                          x-html="step.output"
                        ></pre>
                      </template>
                    </div>
                  </div>
                </li>
              </template>
            </ol>
          </template>
        </div>
        <div class="flex flex-col gap-4 col-span-5">
          <brutalist-card
            x-show="keypair"
            x-bind:content="keypair ? `Public Key: ${keypair.hash}` : ''"
            title="Your keypair"
          >
          </brutalist-card>

          <brutalist-card
            title="Example Title 2"
            content="AnotherLongStringToDemonstrateWrappingAndClipboardFunctionalityWithDifferentContentForTestingPurposes"
          ></brutalist-card>
        </div>
      </div>
    </div>

    <script>
      function PQSpread() {
        return {
          mode: null, // 'encrypt' or 'decrypt'
          steps: [],
          currentStep: 0,
          loadingSteps: [],
          publicKey: "",

          init() {
            this.keypair =
              JSON.parse(localStorage.getItem("pqs_keypair")) || null;
            // Watch for external changes
            window.addEventListener("keypair-updated", () => {
              this.keypair = JSON.parse(localStorage.getItem("pqs_keypair"));
            });
          },

          // Set mode and define steps
          setMode(selectedMode) {
            this.mode = selectedMode;
            this.steps =
              selectedMode === "encrypt"
                ? [
                    {
                      title: "Generate Key",
                      action: keygen,
                      output: "",
                    },
                    {
                      title: "Upload Document",
                      action: null,
                      output: "Please upload a file.",
                      uploadFile: true,
                    },
                    {
                      title: "Encrypt Document",
                      action: this.encryptFile,
                      output: "",
                      uploadFile: false,
                    },
                  ]
                : [
                    {
                      title: "Generate Key",
                      action: keygen,
                      output: "",
                      uploadFile: false,
                    },
                    {
                      title: "Import Sender‚Äôs Public Key",
                      action: this.importPublicKey,
                      output: "",
                      uploadFile: false,
                      importPublicKey: true,
                    },
                    {
                      title: "Upload Document",
                      action: null,
                      output: "Please upload a file.",
                      uploadFile: true,
                    },
                    {
                      title: "Decrypt Document",
                      action: this.decryptFile,
                      output: "",
                      uploadFile: false,
                    },
                  ];
            this.currentStep = 0;
            this.loadingSteps = Array(this.steps.length).fill(false);
          },

          // Sample actions for steps
          async encryptFile() {
            return new Promise((resolve) =>
              setTimeout(() => resolve("File encrypted with ML-KEM512!"), 1500),
            );
          },
          async importPublicKey() {
            if (!this.publicKey.trim()) {
              return "Please enter a valid public key.";
            }
            return `Public Key imported:\n${this.publicKey.trim().substring(0, 50)}...`;
          },
          async decryptFile() {
            return new Promise((resolve) =>
              setTimeout(() => resolve("File decrypted successfully!"), 1500),
            );
          },

          // Handle step actions
          async handleStepAction(step, index) {
            if (step.uploadFile) {
              document.getElementById("fileUpload").click();
            } else if (step.action) {
              this.loadingSteps[index] = true;
              const result = await step.action();
              this.steps[index].output = result;
              this.loadingSteps[index] = false;
              this.advanceStep();
            }
          },

          // Handle file upload and convert to Base64
          async handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
              this.loadingSteps[this.currentStep] = true;
              const base64String = await this.fileToBase64(file);
              this.steps[this.currentStep].output =
                `File: ${file.name} (${(file.size / 1024).toFixed(2)} KB)\nBase64: ${base64String.substring(0, 50)}...`;
              this.loadingSteps[this.currentStep] = false;
              this.advanceStep();
            }
          },

          // Utility function to convert file to Base64
          fileToBase64(file) {
            return new Promise((resolve, reject) => {
              const reader = new FileReader();
              reader.onload = () => resolve(reader.result);
              reader.onerror = (error) => reject(error);
              reader.readAsDataURL(file);
            });
          },

          // Advance to the next step
          advanceStep() {
            if (this.currentStep < this.steps.length - 1) {
              this.currentStep++;
            }
          },
        };
      }
    </script>
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
